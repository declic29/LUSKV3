{% extends "simple/base.html" %}

{% block content %}
<!-- [Votre contenu HTML existant reste inchangé jusqu'au bloc extra_js] -->
{% endblock %}

{% block extra_js %}
<style>
/* [Vos styles CSS existants restent inchangés] */
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fonction pour générer les traductions inverses automatiquement
    function createBidirectionalTranslations(baseTranslations) {
        const result = JSON.parse(JSON.stringify(baseTranslations)); // Copie profonde
        
        for (const [sourceLang, targets] of Object.entries(baseTranslations)) {
            for (const [targetLang, translations] of Object.entries(targets)) {
                if (!result[targetLang]) result[targetLang] = {};
                
                // Inverse les paires clé-valeur
                const invertedTranslations = {};
                for (const [key, value] of Object.entries(translations)) {
                    invertedTranslations[value] = key;
                }
                
                result[targetLang][sourceLang] = invertedTranslations;
            }
        }
        return result;
    }

    // Dictionnaire de base (unidirectionnel)
    const baseTranslations = {
        'fr': {
            'br': {
                'Bonjour': 'Demat',
                'Au revoir': 'Kenavo',
                'Merci': 'Trugarez',
                'S\'il vous plaît': 'Mar plij',
                'Bienvenue': 'Degemer mat',
                'Bretagne': 'Breizh'
            },
            'en': {
                'Bonjour': 'Hello',
                'Au revoir': 'Goodbye',
                'Merci': 'Thank you',
                'S\'il vous plaît': 'Please',
                'Bienvenue': 'Welcome',
                'Bretagne': 'Brittany'
            },
            'es': {
                'Bonjour': 'Hola',
                'Au revoir': 'Adiós',
                'Merci': 'Gracias',
                'S\'il vous plaît': 'Por favor',
                'Bienvenue': 'Bienvenido',
                'Bretagne': 'Bretaña'
            },
            'de': {
                'Bonjour': 'Hallo',
                'Au revoir': 'Auf Wiedersehen',
                'Merci': 'Danke',
                'S\'il vous plaît': 'Bitte',
                'Bienvenue': 'Willkommen',
                'Bretagne': 'Bretagne'
            }
            // [Ajoutez d'autres langues cibles depuis le français si besoin]
        }
        // [Ajoutez d'autres langues sources si besoin]
    };

    // Génère toutes les combinaisons inverses automatiquement
    const translations = createBidirectionalTranslations(baseTranslations);

    // [Le reste de votre JavaScript existant reste inchangé]
    document.getElementById('translate-btn').addEventListener('click', function() {
        const sourceText = document.getElementById('source-text').value.trim();
        const sourceLang = document.getElementById('source-lang').value;
        const targetLang = document.getElementById('target-lang').value;
        
        if (!sourceText) {
            document.getElementById('target-text').value = "";
            return;
        }
        
        if (!translations[sourceLang]?.[targetLang]) {
            document.getElementById('target-text').value = "Combinaison de langues non supportée";
            return;
        }
        
        let translatedText = sourceText;
        const translationDict = translations[sourceLang][targetLang];
        const sortedKeys = Object.keys(translationDict).sort((a,b) => b.length - a.length);
        
        for (const key of sortedKeys) {
            const regex = new RegExp(`\\b${key}\\b`, 'gi');
            translatedText = translatedText.replace(regex, translationDict[key]);
        }
        
        document.getElementById('target-text').value = translatedText;
    });

    document.getElementById('swap-lang').addEventListener('click', function() {
        const source = document.getElementById('source-lang');
        const target = document.getElementById('target-lang');
        const sourceText = document.getElementById('source-text');
        const targetText = document.getElementById('target-text');
        
        [source.value, target.value] = [target.value, source.value];
        
        if (targetText.value && !sourceText.value) {
            sourceText.value = targetText.value;
            targetText.value = "";
        }
    });

    // [Votre code existant pour les actualités reste inchangé]
    const apiKey = '2a28af6c4ebc58d5beba1fc150c105eb';
    
    function fetchNews(apiKey) {
        // ... (votre fonction existante)
    }

    if (apiKey) fetchNews(apiKey);
});
</script>
{% endblock %}
